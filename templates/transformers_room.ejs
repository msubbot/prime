<% layout('/layout/page')%>
<% block('title', 'transformers room')%>
<script>
    let Transformer = require('../models/transformer').Transformer;

    let transformersBase;
    Transformer.find({}, function (err, transformers) {
        transformersBase = transformers.toJSON();
        debugger;
    });
</script>

<div class="container">
    <p>Transformers exist: </p>
    <ul id="transformers">
        <% for (let i = 0; i < transformersBase.length; i++) {%>
            <%= transformersBase[i].name %>
        <% } %>
    </ul>
</div>
<script>

    subscribe();

    function subscribe() {
        let xhr = new XMLHttpRequest();

        xhr.open("GET", "subscribe", true);

        xhr.onload = function () {
            let li = document.createElement("li");
            li.textContent = this.responseText;
            transformers.appendChild(li);

            subscribe();
        };

        xhr.onerror = xhr.onabort = function () {
            setTimeout(subscribe, 500);
        };

        xhr.send('');
    }
</script>