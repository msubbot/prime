<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Creation</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
    <p>Create your own transformer!</p>

    <form id="publish" class="form-inline">
        <ul>
            <li>Name: <input type="text" name="name"/></li>
            <li>Autobot/Decepticon: <input type="text" name="type"/> </li>
            <li>Home Planet: <input type="text" name="home_planet"/> </li>
            <li>Attack: <input type="text" name="attack"/></li>
            <li>Health: <input type="text" name="health"/></li>
            <input type="submit" class="btn btn-primary" value="Create"/>
        </ul>
    </form>
</div>
<div class="container">
    <p>Transformers exist: </p>
    <ul id="transformers"></ul>
</div>
<script>

    function Transformer(name, planet, health, attack, type) {
        this.name = name;
        this.homePlanet = planet;
        this.health = health;
        this.attack  = attack;
        this.type = type;
    };

    publish.onsubmit=function () {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/publish", true);
        var inputData = {
            name: this.elements.name.value,
            type: this.elements.type.value,
            home_planet: this.elements.home_planet.value,
            attack: this.elements.attack.value,
            health: this.elements.health.value
        }
        var newTransformer = new Transformer(inputData.name, inputData.home_planet, inputData.attack, inputData.health, inputData.type);
        xhr.send(JSON.stringify(newTransformer));
        this.elements.name.value =  "";
        this.elements.type.value =  "";
        this.elements.home_planet.value =  "";
        this.elements.attack.value =  "";
        this.elements.health.value =  "";
        return false;
    };

    subscribe();

    function subscribe() {
        var xhr = new XMLHttpRequest();

        xhr.open("GET", "subscribe", true);

        xhr.onload = function () {
            var li = document.createElement("li");
            li.textContent = this.responseText;
            transformers.appendChild(li);

            subscribe();
        };

        xhr.onerror = xhr.onabort = function () {
            setTimeout(subscribe, 500);
        };

        xhr.send('');
    }

</script>
</body>
</html>